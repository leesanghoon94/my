- name: copy build
  hosts: app
  remote_user: ec2-user
  become: true
  tasks:
    - name: Copy files
      ansible.builtin.copy:
        src: /var/lib/jenkins/workspace/backend/my/server
        dest: /home/ec2-user/
        owner: ec2-user
        group: ec2-user
        mode: 644
    - name: node
      ansible.builtin.shell: |
        . ~/.nvm/nvm.sh
        nvm install 16
        node -v

    - name: npm i
      ansible.builtin.shell: |
        chown -R ec2-user:ec2-user server/
        cd /home/ec2-user/server
        npm install

    - name: kill npm
      command: pkill -f 'npm start'
      ignore_errors: true

    - name: start npm
      shell:
        cmd: |
          cd /home/ec2-user
          npm start
